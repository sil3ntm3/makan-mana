<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Makan Mana??!</title>

  <!-- Leaflet (OSM maps) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Opening hours parser -->
  <script src="https://cdn.jsdelivr.net/npm/opening_hours@3.10.0/opening_hours.min.js"></script>

  <style>
    :root { 
      --bg:#F5DDC2; 
      --fg:#111; 
      --muted:#444; 
      --card:#fff; 
      --accent:#F45F67; 
      --border:#ccc; 
      --radius:16px;
      --pad:16px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);color:var(--fg);
      padding-left:max(var(--pad),env(safe-area-inset-left));
      padding-right:max(var(--pad),env(safe-area-inset-right));
    }
    .wrap{max-width:980px;margin:32px auto;padding-top:calc(var(--pad) + var(--safe-top));padding-bottom:calc(var(--pad) + var(--safe-bottom))}
    h1{margin:0 0 4px;font-size:clamp(24px,2.2vw,32px)}
    p.small{color:var(--muted);margin:4px 0 16px;font-size:clamp(12px,1.4vw,14px)}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:360px 1fr}}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:var(--pad)}
    .controls{display:flex;flex-direction:column;gap:12px}
    .row{display:flex;flex-wrap:wrap;gap:10px}
    .row>label,.row>button{flex:1 1 160px}
    label{font-size:12px;color:var(--muted);display:flex;flex-direction:column;gap:6px}
    select,input{background:#fff;color:var(--fg);border:1px solid var(--border);border-radius:999px;padding:12px 14px;min-width:120px;font-size:14px}
    .hint{font-size:12px;color:var(--muted)}
    button{border:0;background:var(--accent);color:#fff;padding:14px 16px;border-radius:999px;cursor:pointer;font-weight:600}
    button.secondary{background:#fff;color:var(--fg);border:1px solid var(--border)}
    button.warn{background:#f59e0b;color:#fff}
    button:disabled{opacity:.6;cursor:not-allowed}
    #map{height:clamp(320px,60vh,520px);border-radius:12px;overflow:hidden;border:1px solid var(--border)}
    .result{margin-top:12px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .title{font-weight:700;font-size:clamp(16px,1.8vw,18px)}
    .badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
    .badge{font-size:12px;color:#333;background:#eee;border:1px solid #ddd;padding:4px 8px;border-radius:999px}
    .links{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    a.btn{display:inline-block;padding:10px 12px;border-radius:999px;border:1px solid var(--border);background:var(--accent);color:#fff;flex:1 1 180px;text-align:center;text-decoration:none}
    .disclaimer{font-size:12px;color:var(--muted);margin-top:8px}
    footer{color:var(--muted);font-size:12px;margin-top:12px}
    .banner{margin:8px 0;padding:10px;border-radius:10px;border:1px solid var(--border)}
    .banner.error{background:#fdd;color:#600;border-color:#7f1d1d}
    .banner.info{background:#eef;color:#112;border-color:#1f2937}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Makan Mana?!</h1>
    <p class="small">Soalan paling susah sepanjang zaman. Jangan Risau!. Pilih kawasan dan tekan. Mesti pilih tempat makan tu!. Baru syiok.</p>

    <div id="banner" class="banner info" hidden></div>

    <div class="grid">
      <!-- Controls -->
      <div class="panel">
        <div class="controls">
          <div class="row">
            <label>Radius
              <select id="radius">
                <option value="800">0.8 km</option>
                <option value="1000" selected>1 km</option>
                <option value="2000">2 km</option>
                <option value="3000">3 km</option>
                <option value="5000">5 km</option>
              </select>
            </label>
            <label>Type
              <select id="type">
                <option value="restaurant" selected>Restaurant</option>
                <option value="fast_food">Fast food</option>
                <option value="cafe">Cafe</option>
                <option value="food_court">Food court</option>
              </select>
            </label>
          </div>
          <div class="row">
            <label>Keyword (halal, thai, nasi, burger...) 
              <input id="keyword" placeholder="optional" />
            </label>
            <label>Open now
              <select id="openNow">
                <option value="">Any</option>
                <option value="1" selected>Yes</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button id="btnGo">I’m Hungry</button>
            <button id="btnReroll" class="secondary" disabled>Reroll (2)</button>
            <button id="btnLock" class="secondary" disabled>Lock It In</button>
          </div>
          <button id="btnUsePin" class="warn">Use Map Pin Instead of GPS</button>
          <div class="hint">If location permission fails, pan/zoom the map and click “Use Map Pin”.</div>
        </div>
      </div>

      <!-- Map + Result -->
      <div class="panel">
        <div id="map"></div>
        <div id="result" class="result" hidden></div>
        <div class="disclaimer"><!--Places from OpenStreetMap via Overpass API. -->Data quality varies by area. Please verify halal status and opening hours.</div>
      </div>
    </div>

    <footer>Powered by OpenStreetMap. Made by Syazani Said.</footer>
  </div>

<script>
/* same JS as before, only change: removed OSM buttons in showResult */
function showResult(place, userLatLng){
  const elResult = document.getElementById('result');
  if(!place){elResult.hidden=false;elResult.innerHTML='No places found.';return;}
  const dist=Math.round(place._distance);
  const name=place.tags.name||'(Unnamed place)';
  const cuisine=place.tags.cuisine?String(place.tags.cuisine).split(';').join(', '):'—';
  const isOpen=(function(tag){try{if(!tag)return null;return new opening_hours(tag).getState();}catch(e){return null;}})(place.tags['opening_hours']);
  const openStr=(isOpen===null)?'hours unknown':(isOpen?'open now':'closed now');
  const lat=place.lat,lon=place.lon;
  const waze=`https://waze.com/ul?ll=${lat}%2C${lon}&navigate=yes`;
  const apple=`https://maps.apple.com/?daddr=${lat},${lon}`;
  const gmaps=`https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
  elResult.hidden=false;
  elResult.innerHTML=`
    <div class="title">${name}</div>
    <div class="badges">
      <span class="badge">cuisine: ${cuisine}</span>
      <span class="badge">${dist} m away</span>
      <span class="badge">${openStr}</span>
    </div>
    <div class="links">
      <a class="btn" href="${waze}" target="_blank">Open in Waze</a>
      <a class="btn" href="${apple}" target="_blank">Open in Apple Maps</a>
      <a class="btn" href="${gmaps}" target="_blank">Open in Google Maps</a>
    </div>
  `;
}

/* rest of JS (geolocation, overpass, reroll, etc.) unchanged */
</script>
</body>
</html>
